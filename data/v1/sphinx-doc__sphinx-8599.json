{
    "id": "sphinx-doc__sphinx-8599",
    "repo_name": "testbed/sphinx-doc__sphinx__3.5",
    "task_id": 1964454607592767905,
    "title": "Allow custom link texts for permalinks and links to source code.",
    "body": "I'd like to be able to customize the content of the HTML links that Sphinx generates for permalinks and links to source code (generated by the `viewcode` extension).\r\n\r\nE.g. instead of ``<a class=\"headerlink\" href=\"...\" title=\"Permalink to this definition\">\u00b6</a>``, I'd like to have ``<a class=\"headerlink\" href=\"...\" title=\"Permalink to this definition\"><i class=\"fas fa-link\"></i></a>`` to use [FontAwesome](https://fontawesome.com/) icons.\r\n\r\nNote that the \"Read The Docs\" theme does this by fidling with the CSS to hide the text of the link and add's the icon via some `:after:` CSS rules.\r\n\r\nIMHO it would be much clearer if this was customizable via configuration options.\r\n\r\nThis patch adds two configuration options:\r\n\r\n`html_add_permalinks_html` which does the same as `html_add_permalinks`, but interprets the value as HTML, not as text.\r\n\r\n`viewcode_source_html` which will be used as the link content for source code links generated by the `viewcode` extension. (The default is `<span class=\"viewcode-link\">[source]</span>`).\r\n\r\nThis is my first attempt to work with the Sphinx source code, and I'm not exactly sure, whether defining a new node for the viewcode link text and replacing that node with the configured HTML in the HTML writer is the correct approach.\r\n\r\nHowever with this patch I can now put\r\n```python\r\nhtml_add_permalinks_html = '<i class=\"fa fa-link\"></i>'\r\n\r\nviewcode_source_html = '<span class=\"viewcode-link\"><i class=\"fa fa-code\"></i></span>'\r\n```\r\n\r\nin my `conf.py` to get nice Font Awesome icons.\n",
    "state": "closed",
    "repo_link": "https://github.com/testbed/sphinx-doc__sphinx__3.5.git",
    "requested_commit": "",
    "mayil_response": "To implement the feature of allowing custom link texts for permalinks and links to source code in Sphinx, you can follow these steps:\n\n- Add two new configuration options in the Sphinx configuration file (`conf.py`):\n  - `html_add_permalinks_html`: This option will allow users to specify HTML content for permalinks.\n  - `viewcode_source_html`: This option will allow users to specify HTML content for source code links generated by the `viewcode` extension.\n\n- Modify the HTML writer to use these new configuration options when generating permalinks and source code links.\n\nHere's a high-level overview of the changes needed in the code:\n\n1. Update the Sphinx configuration (`conf.py`) to include the new options:\n   ```python\n   html_add_permalinks_html = '<i class=\"fa fa-link\"></i>'\n   viewcode_source_html = '<span class=\"viewcode-link\"><i class=\"fa fa-code\"></i></span>'\n   ```\n\n2. Modify the HTML writer to check for these options and use them when generating links. This will likely involve changes in the `sphinx/writers/html.py` or a similar file where the HTML output is generated.\n\n3. For permalinks, you will need to find the part of the code that generates the permalink HTML and replace the text content with the value from `html_add_permalinks_html`.\n\n4. For source code links, you will need to modify the `doctree_read` function in `sphinx/ext/linkcode.py` to use `viewcode_source_html` when creating the `nodes.reference` for the source code link.\n\n5. Ensure that the new configuration options are properly documented and that they are optional, with sensible defaults that preserve the current behavior if the options are not set.\n\n6. Write tests to verify that the new feature works as expected.\n\nHere's a simplified example of how you might modify the permalink generation:\n\n```python\n# In the HTML writer code where permalinks are generated\nif hasattr(self.builder.config, 'html_add_permalinks_html'):\n    permalink_html = self.builder.config.html_add_permalinks_html\n    # Generate the permalink using permalink_html instead of the default text\nelse:\n    # Fallback to the default behavior\n```\n\nAnd for the source code links:\n\n```python\n# In the doctree_read function of linkcode.py\nif hasattr(env.config, 'viewcode_source_html'):\n    link_content = env.config.viewcode_source_html\n    # Create the reference node using link_content as the HTML content\nelse:\n    # Fallback to the default behavior\n```\n\nPlease note that the actual implementation will require a detailed understanding of the Sphinx codebase and how it generates HTML output. The above code is a simplified representation and may not work without proper integration into the Sphinx framework.\n\n### Code snippets to check\n\n-  \u2192 [sphinx](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx) \u2192 [ext](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/ext)- [Lines 1 - 73](https://github.com/testbed/sphinx-doc__sphinx__3.5/blob//sphinx/ext/linkcode.py#L1-L73)\n\n This snippet is from 'sphinx/ext/linkcode.py' which is relevant because the issue mentions the need to customize links to source code, which is handled by the 'linkcode' extension.\n-  \u2192 [sphinx](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx) \u2192 [builders](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/builders) \u2192 [html](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/builders/html)- [Lines 1320 - 1373](https://github.com/testbed/sphinx-doc__sphinx__3.5/blob//sphinx/builders/html/__init__.py#L1320-L1373)\n\n This snippet is from 'sphinx/builders/html/__init__.py' and includes configuration options for HTML output, including 'html_permalinks' and 'html_permalinks_icon', which are directly related to the issue of customizing permalink HTML.",
    "ai_cost": {
        "search_embedding": 1.3e-07,
        "issue_classifier": 0.000321,
        "snippet_processor": 0.062240000000000004,
        "issue_star_creation": 0.02068,
        "issue_star_solver": 0.07839,
        "bouncer": 0.031020000000000002
    },
    "mayil_collected_data": {
        "status": "completed",
        "start_time": 1711703125.84017,
        "relevant_snippets": [
            {
                "code": "\"\"\"Extension to save typing and prevent hard-coding of base URLs in reST files.\n\nThis adds a new config value called ``extlinks`` that is created like this::\n\n   extlinks = {'exmpl': ('https://example.invalid/%s.html', caption), ...}\n\nNow you can use e.g. :exmpl:`foo` in your documents.  This will create a\nlink to ``https://example.invalid/foo.html``.  The link caption depends on\nthe *caption* value given:\n\n- If it is ``None``, the caption will be the full URL.\n- If it is a string, it must contain ``%s`` exactly once.  In this case the\n  caption will be *caption* with the role content substituted for ``%s``.\n\nYou can also give an explicit caption, e.g. :exmpl:`Foo <foo>`.\n\nBoth, the url string and the caption string must escape ``%`` as ``%%``.\n\"\"\"\n\nfrom __future__ import annotations\n\nimport re\nfrom typing import Any\n\nfrom docutils import nodes, utils\nfrom docutils.nodes import Node, system_message\nfrom docutils.parsers.rst.states import Inliner\n\nimport sphinx\nfrom sphinx.application import Sphinx\nfrom sphinx.locale import __\nfrom sphinx.transforms.post_transforms import SphinxPostTransform\nfrom sphinx.util import logging, rst\nfrom sphinx.util.nodes import split_explicit_title\nfrom sphinx.util.typing import RoleFunction\n\nlogger = logging.getLogger(__name__)\n\n\nclass ExternalLinksChecker(SphinxPostTransform):\n    \"\"\"\n    For each external link, check if it can be replaced by an extlink.\n\n    We treat each ``reference`` node without ``internal`` attribute as an external link.\n    \"\"\"\n\n    default_priority = 500\n\n    def run(self, **kwargs: Any) -> None:\n        if not self.config.extlinks_detect_hardcoded_links:\n            return\n\n        for refnode in self.document.findall(nodes.reference):\n            self.check_uri(refnode)\n\n    def check_uri(self, refnode: nodes.reference) -> None:\n        \"\"\"\n        If the URI in ``refnode`` has a replacement in ``extlinks``,\n        emit a warning with a replacement suggestion.\n        \"\"\"\n        if 'internal' in refnode or 'refuri' not in refnode:\n            return\n\n        uri = refnode['refuri']\n        title = refnode.astext()\n\n        for alias, (base_uri, _caption) in self.app.config.extlinks.items():\n            uri_pattern = re.compile(re.escape(base_uri).replace('%s', '(?P<value>.+)'))\n\n            match = uri_pattern.match(uri)\n            if (\n                match and\n                match.groupdict().get('value') and\n                '/' not in match.groupdict()['value']\n            ):\n                # build a replacement suggestion\n                msg = __('hardcoded link %r could be replaced by an extlink '\n                         '(try using %r instead)')\n                value = match.groupdict().get('value')\n                if uri != title:\n                    replacement = f\":{alias}:`{rst.escape(title)} <{value}>`\"\n                else:\n                    replacement = f\":{alias}:`{value}`\"\n                logger.warning(msg, uri, replacement, location=refnode)",
                "filename": "sphinx/ext/extlinks.py",
                "start_index": 0,
                "end_index": 2976,
                "start_line": 1,
                "end_line": 84,
                "max_line": 120,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "\"\"\"Add external links to module code in Python object descriptions.\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import Any\n\nfrom docutils import nodes\nfrom docutils.nodes import Node\n\nimport sphinx\nfrom sphinx import addnodes\nfrom sphinx.application import Sphinx\nfrom sphinx.errors import SphinxError\nfrom sphinx.locale import _\n\n\nclass LinkcodeError(SphinxError):\n    category = \"linkcode error\"\n\n\ndef doctree_read(app: Sphinx, doctree: Node) -> None:\n    env = app.builder.env\n\n    resolve_target = getattr(env.config, 'linkcode_resolve', None)\n    if not callable(env.config.linkcode_resolve):\n        raise LinkcodeError(\n            \"Function `linkcode_resolve` is not given in conf.py\")\n\n    domain_keys = {\n        'py': ['module', 'fullname'],\n        'c': ['names'],\n        'cpp': ['names'],\n        'js': ['object', 'fullname'],\n    }\n\n    for objnode in list(doctree.findall(addnodes.desc)):\n        domain = objnode.get('domain')\n        uris: set[str] = set()\n        for signode in objnode:\n            if not isinstance(signode, addnodes.desc_signature):\n                continue\n\n            # Convert signode to a specified format\n            info = {}\n            for key in domain_keys.get(domain, []):\n                value = signode.get(key)\n                if not value:\n                    value = ''\n                info[key] = value\n            if not info:\n                continue\n\n            # Call user code to resolve the link\n            uri = resolve_target(domain, info)\n            if not uri:\n                # no source\n                continue\n\n            if uri in uris or not uri:\n                # only one link per name, please\n                continue\n            uris.add(uri)\n\n            inline = nodes.inline('', _('[source]'), classes=['viewcode-link'])\n            onlynode = addnodes.only(expr='html')\n            onlynode += nodes.reference('', '', inline, internal=False, refuri=uri)\n            signode += onlynode\n\n\ndef setup(app: Sphinx) -> dict[str, Any]:\n    app.connect('doctree-read', doctree_read)\n    app.add_config_value('linkcode_resolve', None, '')\n    return {'version': sphinx.__display_version__, 'parallel_read_safe': True}",
                "filename": "sphinx/ext/linkcode.py",
                "start_index": 0,
                "end_index": 2202,
                "start_line": 1,
                "end_line": 73,
                "max_line": 73,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "{\n        \"%(filename)s &#8212; %(docstitle)s\": \"%(filename)s &#8212; %(docstitle)s\",\n        \"&#169; <a href=\\\"%(path)s\\\">Copyright</a> %(copyright)s.\": \"&#169; <a href=\\\"%(path)s\\\">Copyright</a>%(copyright)s\",\n        \"&#169; Copyright %(copyright)s.\": \"&#169; Copyright %(copyright)s.\",\n        \", in \": \", \\u03c3\\u03c4\\u03bf \",\n        \"About these documents\": \"\\u03a3\\u03c7\\u03b5\\u03c4\\u03b9\\u03ba\\u03ac \\u03bc\\u03b5 \\u03b1\\u03c5\\u03c4\\u03ac \\u03c4\\u03b1 \\u03ba\\u03b5\\u03af\\u03bc\\u03b5\\u03bd\\u03b1\",\n        \"Automatically generated list of changes in version %(version)s\": \"\\u0391\\u03c5\\u03c4\\u03cc\\u03bc\\u03b1\\u03c4\\u03b1 \\u03c0\\u03b1\\u03c1\\u03b1\\u03b3\\u03cc\\u03bc\\u03b5\\u03bd\\u03b7 \\u03bb\\u03af\\u03c3\\u03c4\\u03b1 \\u03b1\\u03bb\\u03bb\\u03b1\\u03b3\\u03ce\\u03bd \\u03c3\\u03c4\\u03b7\\u03bd \\u03ad\\u03ba\\u03b4\\u03bf\\u03c3\\u03b7 %(version)s\",\n        \"C API changes\": \"\\u0391\\u03bb\\u03bb\\u03b1\\u03b3\\u03ad\\u03c2 \\u03c3\\u03c4\\u03bf API \\u03c4\\u03b7\\u03c2 C\",\n        \"Changes in Version %(version)s &#8212; %(docstitle)s\": \"\\u0391\\u03bb\\u03bb\\u03b1\\u03b3\\u03ad\\u03c2 \\u03c3\\u03c4\\u03b7\\u03bd \\u0388\\u03ba\\u03b4\\u03bf\\u03c3\\u03b7 %(version)s &#8212'\\n%(docstitle)s\",\n        \"Collapse sidebar\": \"\\u039a\\u03bb\\u03b5\\u03af\\u03c3\\u03b9\\u03bc\\u03bf \\u03c0\\u03bb\\u03b1\\u03ca\\u03bd\\u03ae\\u03c2 \\u03bc\\u03c0\\u03ac\\u03c1\\u03b1\\u03c2\",\n        \"Complete Table of Contents\": \"\\u03a0\\u03bb\\u03ae\\u03c1\\u03b7\\u03c2 \\u03a0\\u03af\\u03bd\\u03b1\\u03ba\\u03b1\\u03c2 \\u03a0\\u03b5\\u03c1\\u03b9\\u03b5\\u03c7\\u03bf\\u03bc\\u03ad\\u03bd\\u03c9\\u03bd\",\n        \"Contents\": \"\\u03a0\\u03b5\\u03c1\\u03b9\\u03b5\\u03c7\\u03cc\\u03bc\\u03b5\\u03bd\\u03b1\",\n        \"Copyright\": \"Copyright\",\n        \"Created using <a href=\\\"https://www.sphinx-doc.org/\\\">Sphinx</a> %(sphinx_version)s.\": \"\",\n        \"Expand sidebar\": \"\\u0386\\u03bd\\u03bf\\u03b9\\u03b3\\u03bc\\u03b1 \\u03c0\\u03bb\\u03b1\\u03ca\\u03bd\\u03ae\\u03c2 \\u03bc\\u03c0\\u03ac\\u03c1\\u03b1\\u03c2\",\n        \"Full index on one page\": \"\\u03a0\\u03bb\\u03ae\\u03c1\\u03b5\\u03c2 \\u03b5\\u03c5\\u03c1\\u03b5\\u03c4\\u03ae\\u03c1\\u03b9\\u03bf \\u03c3\\u03b5 \\u03bc\\u03af\\u03b1 \\u03c3\\u03b5\\u03bb\\u03af\\u03b4\\u03b1\",\n        \"General Index\": \"\\u039a\\u03b5\\u03bd\\u03c4\\u03c1\\u03b9\\u03ba\\u03cc \\u0395\\u03c5\\u03c1\\u03b5\\u03c4\\u03ae\\u03c1\\u03b9\\u03bf\\u03bf\",\n        \"Global Module Index\": \"\\u039a\\u03b1\\u03b8\\u03bf\\u03bb\\u03b9\\u03ba\\u03cc \\u0395\\u03c5\\u03c1\\u03b5\\u03c4\\u03ae\\u03c1\\u03b9\\u03bf \\u039c\\u03bf\\u03bd\\u03ac\\u03b4\\u03c9\\u03bd\",\n        \"Go\": \"\\u03a0\\u03ac\\u03bc\\u03b5\",\n        \"Hide Search Matches\": \"\\u0391\\u03c0\\u03cc\\u03ba\\u03c1\\u03c5\\u03c8\\u03b7 \\u0395\\u03c5\\u03c1\\u03b5\\u03b8\\u03ad\\u03bd\\u03c4\\u03c9\\u03bd \\u0391\\u03bd\\u03b1\\u03b6\\u03b7\\u03c4\\u03ae\\u03c3\\u03b5\\u03c9\\u03bd\",\n        \"Index\": \"\\u0395\\u03c5\\u03c1\\u03b5\\u03c4\\u03ae\\u03c1\\u03b9\\u03bf\",\n        \"Index &ndash; %(key)s\": \"\\u0395\\u03c5\\u03c1\\u03b5\\u03c4\\u03ae\\u03c1\\u03b9\\u03bf &ndash; %(key)s\",",
                "filename": "sphinx/locale/el/LC_MESSAGES/sphinx.js",
                "start_index": 68,
                "end_index": 2911,
                "start_line": 1,
                "end_line": 24,
                "max_line": 61,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "/* Highlighting utilities for Sphinx HTML documentation. */\n\"use strict\";\n\nconst SPHINX_HIGHLIGHT_ENABLED = true\n\n/**\n * highlight a given string on a node by wrapping it in\n * span elements with the given class name.\n */\nconst _highlight = (node, addItems, text, className) => {\n  if (node.nodeType === Node.TEXT_NODE) {\n    const val = node.nodeValue;\n    const parent = node.parentNode;\n    const pos = val.toLowerCase().indexOf(text);\n    if (\n      pos >= 0 &&\n      !parent.classList.contains(className) &&\n      !parent.classList.contains(\"nohighlight\")\n    ) {\n      let span;\n\n      const closestNode = parent.closest(\"body, svg, foreignObject\");\n      const isInSVG = closestNode && closestNode.matches(\"svg\");\n      if (isInSVG) {\n        span = document.createElementNS(\"http://www.w3.org/2000/svg\", \"tspan\");\n      } else {\n        span = document.createElement(\"span\");\n        span.classList.add(className);\n      }\n\n      span.appendChild(document.createTextNode(val.substr(pos, text.length)));\n      parent.insertBefore(\n        span,\n        parent.insertBefore(\n          document.createTextNode(val.substr(pos + text.length)),\n          node.nextSibling\n        )\n      );\n      node.nodeValue = val.substr(0, pos);\n\n      if (isInSVG) {\n        const rect = document.createElementNS(\n          \"http://www.w3.org/2000/svg\",\n          \"rect\"\n        );\n        const bbox = parent.getBBox();\n        rect.x.baseVal.value = bbox.x;\n        rect.y.baseVal.value = bbox.y;\n        rect.width.baseVal.value = bbox.width;\n        rect.height.baseVal.value = bbox.height;\n        rect.setAttribute(\"class\", className);\n        addItems.push({ parent: parent, target: rect });\n      }\n    }\n  } else if (node.matches && !node.matches(\"button, select, textarea\")) {\n    node.childNodes.forEach((el) => _highlight(el, addItems, text, className));\n  }\n};\nconst _highlightText = (thisNode, text, className) => {\n  let addItems = [];\n  _highlight(thisNode, addItems, text, className);\n  addItems.forEach((obj) =>\n    obj.parent.insertAdjacentElement(\"beforebegin\", obj.target)\n  );\n};\n\n/**\n * Small JavaScript module for the documentation.\n */",
                "filename": "sphinx/themes/basic/static/sphinx_highlight.js",
                "start_index": 0,
                "end_index": 2151,
                "start_line": 1,
                "end_line": 115,
                "max_line": 144,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "{\n        \"%(filename)s &#8212; %(docstitle)s\": \"%(filename)s &#8212; %(docstitle)s\",\n        \"&#169; <a href=\\\"%(path)s\\\">Copyright</a> %(copyright)s.\": \"&#169; <a href=\\\"%(path)s\\\">\\u0938\\u0930\\u094d\\u0935\\u093e\\u0927\\u093f\\u0915\\u093e\\u0930</a> %(copyright)s.\",\n        \"&#169; Copyright %(copyright)s.\": \"&#169; \\u0938\\u0930\\u094d\\u0935\\u093e\\u0927\\u093f\\u0915\\u093e\\u0930 %(copyright)s.\",\n        \", in \": \", \\u092e\\u0947\\u0902 \",\n        \"About these documents\": \"\\u0907\\u0928 \\u0932\\u0947\\u0916\\u092a\\u0924\\u094d\\u0930\\u094b\\u0902 \\u0915\\u0947 \\u092c\\u093e\\u0930\\u0947 \\u092e\\u0947\\u0902\",\n        \"Automatically generated list of changes in version %(version)s\": \"\\u0938\\u0902\\u0938\\u094d\\u0915\\u0930\\u0923 %(version)s \\u092e\\u0947\\u0902 \\u0938\\u094d\\u0935\\u0924\\u0903 \\u0930\\u091a\\u093f\\u0924 \\u092a\\u0930\\u093f\\u0935\\u0930\\u094d\\u0924\\u0928\\u094b\\u0902 \\u0915\\u0940 \\u0938\\u0942\\u091a\\u0940\",\n        \"C API changes\": \"\\u0938\\u0940 \\u0910.\\u092a\\u0940.\\u0906\\u0908. \\u092a\\u0930\\u093f\\u0935\\u0930\\u094d\\u0924\\u0928\",\n        \"Changes in Version %(version)s &#8212; %(docstitle)s\": \"\\u092a\\u0930\\u093f\\u0935\\u0930\\u094d\\u0924\\u093f\\u0924 \\u0938\\u0902\\u0938\\u094d\\u0915\\u0930\\u0923 %(version)s &#8212; %(docstitle)s\",\n        \"Collapse sidebar\": \"\\u0915\\u093f\\u0928\\u093e\\u0930\\u0947 \\u0915\\u093e \\u0938\\u094d\\u0925\\u093e\\u0928 \\u0918\\u091f\\u093e\\u090f\\u0902\",\n        \"Complete Table of Contents\": \"\\u0935\\u093f\\u0938\\u094d\\u0924\\u0943\\u0924 \\u0935\\u093f\\u0937\\u092f-\\u0938\\u0942\\u091a\\u0940\",\n        \"Contents\": \"\\u0935\\u093f\\u0937\\u092f \\u0938\\u093e\\u092e\\u093f\\u0917\\u094d\\u0930\\u0940\",\n        \"Copyright\": \"\\u0938\\u0930\\u094d\\u0935\\u093e\\u0927\\u093f\\u0915\\u093e\\u0930\",\n        \"Created using <a href=\\\"https://www.sphinx-doc.org/\\\">Sphinx</a> %(sphinx_version)s.\": \"\",\n        \"Expand sidebar\": \"\\u0915\\u093f\\u0928\\u093e\\u0930\\u0947 \\u0915\\u093e \\u0938\\u094d\\u0925\\u093e\\u0928 \\u092c\\u095d\\u093e\\u090f\\u0902\",\n        \"Full index on one page\": \"\\u090f\\u0915 \\u092a\\u0943\\u0937\\u094d\\u0920 \\u092a\\u0930 \\u092a\\u0942\\u0930\\u0940 \\u0905\\u0928\\u0941\\u0915\\u094d\\u0930\\u092e\\u0923\\u093f\\u0915\\u093e\",\n        \"General Index\": \"\\u0938\\u093e\\u092e\\u093e\\u0928\\u094d\\u092f \\u0905\\u0928\\u0941\\u0915\\u094d\\u0930\\u092e\\u093e\\u0923\\u093f\\u0915\\u093e\",\n        \"Global Module Index\": \"\\u0938\\u093e\\u0930\\u094d\\u0935\\u092d\\u094c\\u092e\\u093f\\u0915 \\u092a\\u094d\\u0930\\u092d\\u093e\\u0917 \\u0938\\u0942\\u091a\\u0940\",\n        \"Go\": \"\\u091a\\u0932\\u093f\\u090f\",\n        \"Hide Search Matches\": \"\\u0916\\u094b\\u091c\\u0947 \\u0917\\u090f \\u091c\\u094b\\u095c\\u0947 \\u091b\\u093f\\u092a\\u093e\\u090f\\u0902\",\n        \"Index\": \"\\u0905\\u0928\\u0941\\u0915\\u094d\\u0930\\u092e\\u0923\\u093f\\u0915\\u093e\",\n        \"Index &ndash; %(key)s\": \"\\u0905\\u0928\\u0941\\u0915\\u094d\\u0930\\u092e\\u0923\\u093f\\u0915\\u093e &ndash; %(key)s\",\n        \"Index pages by letter\": \"\\u0905\\u0915\\u094d\\u0937\\u0930 \\u0926\\u094d\\u0935\\u093e\\u0930\\u093e \\u0905\\u0928\\u0941\\u0915\\u094d\\u0930\\u092e\\u093f\\u0924 \\u092a\\u0943\\u0937\\u094d\\u0920\",",
                "filename": "sphinx/locale/hi/LC_MESSAGES/sphinx.js",
                "start_index": 68,
                "end_index": 3052,
                "start_line": 1,
                "end_line": 25,
                "max_line": 61,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "class SphinxSmartQuotes(SmartQuotes, SphinxTransform):\n    \"\"\"\n    Customized SmartQuotes to avoid transform for some extra node types.\n\n    refs: sphinx.parsers.RSTParser\n    \"\"\"\n    default_priority = 750\n\n    def apply(self, **kwargs: Any) -> None:\n        if not self.is_available():\n            return\n\n        # override default settings with :confval:`smartquotes_action`\n        self.smartquotes_action = self.config.smartquotes_action\n\n        super().apply()\n\n    def is_available(self) -> bool:\n        builders = self.config.smartquotes_excludes.get('builders', [])\n        languages = self.config.smartquotes_excludes.get('languages', [])\n\n        if self.document.settings.smart_quotes is False:\n            # disabled by 3rd party extension (workaround)\n            return False\n        if self.config.smartquotes is False:\n            # disabled by confval smartquotes\n            return False\n        if self.app.builder.name in builders:\n            # disabled by confval smartquotes_excludes['builders']\n            return False\n        if self.config.language in languages:\n            # disabled by confval smartquotes_excludes['languages']\n            return False\n\n        # confirm selected language supports smart_quotes or not\n        language = self.env.settings['language_code']\n        return any(\n            tag in smartchars.quotes\n            for tag in normalize_language_tag(language)\n        )\n\n    def get_tokens(self, txtnodes: list[Text]) -> Generator[tuple[str, str], None, None]:\n        # A generator that yields ``(texttype, nodetext)`` tuples for a list\n        # of \"Text\" nodes (interface to ``smartquotes.educate_tokens()``).\n        for txtnode in txtnodes:\n            if is_smartquotable(txtnode):\n                # SmartQuotes uses backslash escapes instead of null-escapes\n                text = re.sub(r'(?<=\\x00)([-\\\\\\'\".`])', r'\\\\\\1', str(txtnode))\n                yield 'plain', text\n            else:\n                # skip smart quotes\n                yield 'literal', txtnode.astext()\n\n\nclass DoctreeReadEvent(SphinxTransform):\n    \"\"\"Emit :event:`doctree-read` event.\"\"\"\n    default_priority = 880\n\n    def apply(self, **kwargs: Any) -> None:\n        self.app.emit('doctree-read', self.document)\n\n\nclass ManpageLink(SphinxTransform):\n    \"\"\"Find manpage section numbers and names\"\"\"\n    default_priority = 999\n\n    def apply(self, **kwargs: Any) -> None:\n        for node in self.document.findall(addnodes.manpage):\n            manpage = ' '.join([str(x) for x in node.children\n                                if isinstance(x, nodes.Text)])\n            pattern = r'^(?P<path>(?P<page>.+)[\\(\\.](?P<section>[1-9]\\w*)?\\)?)$'\n            info = {'path': manpage,\n                    'page': manpage,\n                    'section': ''}\n            r = re.match(pattern, manpage)\n            if r:\n                info = r.groupdict()\n            node.attributes.update(info)",
                "filename": "sphinx/transforms/__init__.py",
                "start_index": 10007,
                "end_index": 12936,
                "start_line": 299,
                "end_line": 376,
                "max_line": 418,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "{\n        \"%(filename)s &#8212; %(docstitle)s\": \"%(filename)s &#8212; %(docstitle)s\",\n        \"&#169; <a href=\\\"%(path)s\\\">Copyright</a> %(copyright)s.\": \"&#169; <a href=\\\"%(path)s\\\">Copyright</a> %(copyright)s.\",\n        \"&#169; Copyright %(copyright)s.\": \"&#169; Copyright %(copyright)s.\",\n        \", in \": \", \\u0432\",\n        \"About these documents\": \"\\u041e\\u0431 \\u044d\\u0442\\u0438\\u0445 \\u0434\\u043e\\u043a\\u0443\\u043c\\u0435\\u043d\\u0442\\u0430\\u0445\",\n        \"Automatically generated list of changes in version %(version)s\": \"\\u0410\\u0432\\u0442\\u043e\\u043c\\u0430\\u0442\\u0438\\u0447\\u0435\\u0441\\u043a\\u0438 \\u0441\\u043e\\u0437\\u0434\\u0430\\u043d\\u043d\\u044b\\u0439 \\u0441\\u043f\\u0438\\u0441\\u043e\\u043a \\u0438\\u0437\\u043c\\u0435\\u043d\\u0435\\u043d\\u0438\\u0439 \\u0432 \\u0432\\u0435\\u0440\\u0441\\u0438\\u0438 %(version)s\",\n        \"C API changes\": \"\\u0418\\u0437\\u043c\\u0435\\u043d\\u0435\\u043d\\u0438\\u044f \\u0432 API C\",\n        \"Changes in Version %(version)s &#8212; %(docstitle)s\": \"\\u0418\\u0437\\u043c\\u0435\\u043d\\u0435\\u043d\\u0438\\u044f \\u0432 \\u0432\\u0435\\u0440\\u0441\\u0438\\u0438 %(version)s &#8212; %(docstitle)s\",\n        \"Collapse sidebar\": \"\\u0421\\u0432\\u0435\\u0440\\u043d\\u0443\\u0442\\u044c \\u0431\\u043e\\u043a\\u043e\\u0432\\u0443\\u044e \\u043f\\u0430\\u043d\\u0435\\u043b\\u044c\",\n        \"Complete Table of Contents\": \"\\u041f\\u043e\\u043b\\u043d\\u043e\\u0435 \\u043e\\u0433\\u043b\\u0430\\u0432\\u043b\\u0435\\u043d\\u0438\\u0435\",\n        \"Contents\": \"\\u0421\\u043e\\u0434\\u0435\\u0440\\u0436\\u0430\\u043d\\u0438\\u0435\",\n        \"Copyright\": \"\\u0410\\u0432\\u0442\\u043e\\u0440\\u0441\\u043a\\u0438\\u0435 \\u043f\\u0440\\u0430\\u0432\\u0430\",\n        \"Created using <a href=\\\"https://www.sphinx-doc.org/\\\">Sphinx</a> %(sphinx_version)s.\": \"\",\n        \"Expand sidebar\": \"\\u0420\\u0430\\u0437\\u0432\\u0435\\u0440\\u043d\\u0443\\u0442\\u044c \\u0431\\u043e\\u043a\\u043e\\u0432\\u0443\\u044e \\u043f\\u0430\\u043d\\u0435\\u043b\\u044c\",\n        \"Full index on one page\": \"\\u041f\\u043e\\u043b\\u043d\\u044b\\u0439 \\u0430\\u043b\\u0444\\u0430\\u0432\\u0438\\u0442\\u043d\\u044b\\u0439 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u0435\\u043b\\u044c \\u043d\\u0430 \\u043e\\u0434\\u043d\\u043e\\u0439 \\u0441\\u0442\\u0440\\u0430\\u043d\\u0438\\u0446\\u0435\",\n        \"General Index\": \"\\u0410\\u043b\\u0444\\u0430\\u0432\\u0438\\u0442\\u043d\\u044b\\u0439 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u0435\\u043b\\u044c\",\n        \"Global Module Index\": \"\\u0410\\u043b\\u0444\\u0430\\u0432\\u0438\\u0442\\u043d\\u044b\\u0439 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u0435\\u043b\\u044c \\u043c\\u043e\\u0434\\u0443\\u043b\\u0435\\u0439\",\n        \"Go\": \"\\u0418\\u0441\\u043a\\u0430\\u0442\\u044c\",\n        \"Hide Search Matches\": \"\\u0421\\u043d\\u044f\\u0442\\u044c \\u0432\\u044b\\u0434\\u0435\\u043b\\u0435\\u043d\\u0438\\u0435\",\n        \"Index\": \"\\u0410\\u043b\\u0444\\u0430\\u0432\\u0438\\u0442\\u043d\\u044b\\u0439 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u0435\\u043b\\u044c\",\n        \"Index &ndash; %(key)s\": \"\\u0410\\u043b\\u0444\\u0430\\u0432\\u0438\\u0442\\u043d\\u044b\\u0439 \\u0443\\u043a\\u0430\\u0437\\u0430\\u0442\\u0435\\u043b\\u044c &ndash; %(key)s\",",
                "filename": "sphinx/locale/ru/LC_MESSAGES/sphinx.js",
                "start_index": 68,
                "end_index": 3039,
                "start_line": 1,
                "end_line": 24,
                "max_line": 61,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "{\n        \"%(filename)s &#8212; %(docstitle)s\": \"%(filename)s &#8212; %(docstitle)s\",\n        \"&#169; <a href=\\\"%(path)s\\\">Copyright</a> %(copyright)s.\": \"&#169; <a href=\\\"%(path)s\\\">\\uc800\\uc791\\uad8c</a> %(copyright)s.\",\n        \"&#169; Copyright %(copyright)s.\": \"&#169; \\uc800\\uc791\\uad8c %(copyright)s.\",\n        \", in \": \", \\ubb38\\uc11c - \",\n        \"About these documents\": \"\\uc774 \\ubb38\\uc11c \\uc815\\ubcf4\",\n        \"Automatically generated list of changes in version %(version)s\": \"\\ubc84\\uc804 %(version)s\\uc758 \\ubcc0\\uacbd \\uc0ac\\ud56d (\\uc790\\ub3d9\\uc73c\\ub85c \\uc0dd\\uc131\\ub41c \\ubaa9\\ub85d)\",\n        \"C API changes\": \"C API \\ubcc0\\uacbd \\uc0ac\\ud56d\",\n        \"Changes in Version %(version)s &#8212; %(docstitle)s\": \"\\ubc84\\uc804 %(version)s\\uc758 \\ubcc0\\uacbd \\uc0ac\\ud56d &#8212; %(docstitle)s\",\n        \"Collapse sidebar\": \"\\uc0ac\\uc774\\ub4dc\\ubc14 \\ub2eb\\uae30\",\n        \"Complete Table of Contents\": \"\\uc885\\ud569 \\ubaa9\\ucc28\",\n        \"Contents\": \"\\ub0b4\\uc6a9\",\n        \"Copyright\": \"\\uc800\\uc791\\uad8c\",\n        \"Created using <a href=\\\"https://www.sphinx-doc.org/\\\">Sphinx</a> %(sphinx_version)s.\": \"<a href=\\\"https://www.sphinx-doc.org/\\\">Sphinx</a> %(sphinx_version)s \\ubc84\\uc804\\uc73c\\ub85c \\uc0dd\\uc131\\ub418\\uc5c8\\uc2b5\\ub2c8\\ub2e4.\",\n        \"Expand sidebar\": \"\\uc0ac\\uc774\\ub4dc\\ubc14 \\uc5f4\\uae30\",\n        \"Full index on one page\": \"\\ud55c \\ud398\\uc774\\uc9c0\\uc5d0 \\uc804\\uccb4 \\uc0c9\\uc778 \\ubcf4\\uae30\",\n        \"General Index\": \"\\uc804\\uccb4 \\uc0c9\\uc778\",\n        \"Global Module Index\": \"\\ubaa8\\ub4c8 \\ucd1d \\uc0c9\\uc778\",\n        \"Go\": \"\\uc774\\ub3d9\",\n        \"Hide Search Matches\": \"\\uac80\\uc0c9 \\uc77c\\uce58 \\uc228\\uae30\\uae30\",\n        \"Index\": \"\\uc0c9\\uc778\",\n        \"Index &ndash; %(key)s\": \"\\uc0c9\\uc778 &ndash; %(key)s\",\n        \"Index pages by letter\": \"\\uc54c\\ud30c\\ubcb3\\ubcc4 \\uc0c9\\uc778\",\n        \"Indices and tables:\": \"\\uc0c9\\uc778 \\ubc0f \\ud45c \\ubaa9\\ub85d:\",\n        \"Last updated on %(last_updated)s.\": \"\\ucd5c\\uc885 \\uc5c5\\ub370\\uc774\\ud2b8: %(last_updated)s\",\n        \"Library changes\": \"\\ub77c\\uc774\\ube0c\\ub7ec\\ub9ac \\ubcc0\\uacbd \\uc0ac\\ud56d\",\n        \"Navigation\": \"\\ud0d0\\uc0c9\",\n        \"Next topic\": \"\\ub2e4\\uc74c \\ud56d\\ubaa9\",\n        \"Other changes\": \"\\ub2e4\\ub978 \\ubcc0\\uacbd \\uc0ac\\ud56d\",\n        \"Overview\": \"\\uac1c\\uc694\",\n        \"Please activate JavaScript to enable the search\\n    functionality.\": \"\\uac80\\uc0c9 \\uae30\\ub2a5\\uc744 \\uc0ac\\uc6a9\\ud558\\ub824\\uba74 JavaScript\\ub97c \\ud65c\\uc131\\ud654\\ud558\\uc2ed\\uc2dc\\uc624.\",\n        \"Preparing search...\": \"\\uac80\\uc0c9 \\uc900\\ube44 \\uc911\\u2026\",\n        \"Previous topic\": \"\\uc774\\uc804 \\ud56d\\ubaa9\",\n        \"Quick search\": \"\\ube60\\ub978 \\uac80\\uc0c9\",\n        \"Search\": \"\\uac80\\uc0c9\",\n        \"Search Page\": \"\\uac80\\uc0c9 \\ud398\\uc774\\uc9c0\",\n        \"Search Results\": \"\\uac80\\uc0c9 \\uacb0\\uacfc\",",
                "filename": "sphinx/locale/ko/LC_MESSAGES/sphinx.js",
                "start_index": 68,
                "end_index": 2905,
                "start_line": 1,
                "end_line": 39,
                "max_line": 61,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "def html_visit_displaymath(self: HTML5Translator, node: nodes.math_block) -> None:\n    if node['nowrap']:\n        latex = node.astext()\n    else:\n        latex = wrap_displaymath(node.astext(), None, False)\n    try:\n        rendered_path, depth = render_math(self, latex)\n    except MathExtError as exc:\n        msg = str(exc)\n        sm = nodes.system_message(msg, type='WARNING', level=2,\n                                  backrefs=[], source=node.astext())\n        sm.walkabout(self)\n        logger.warning(__('inline latex %r: %s'), node.astext(), msg)\n        raise nodes.SkipNode from exc\n    self.body.append(self.starttag(node, 'div', CLASS='math'))\n    self.body.append('<p>')\n    if node['number']:\n        number = get_node_equation_number(self, node)\n        self.body.append('<span class=\"eqno\">(%s)' % number)\n        self.add_permalink_ref(node, _('Permalink to this equation'))\n        self.body.append('</span>')\n\n    if rendered_path is None:\n        # something failed -- use text-only as a bad substitute\n        self.body.append('<span class=\"math\">%s</span></p>\\n</div>' %\n                         self.encode(node.astext()).strip())\n    else:\n        if self.builder.config.imgmath_embed:\n            image_format = self.builder.config.imgmath_image_format.lower()\n            img_src = render_maths_to_base64(image_format, rendered_path)\n        else:\n            bname = path.basename(rendered_path)\n            relative_path = path.join(self.builder.imgpath, 'math', bname)\n            img_src = relative_path.replace(path.sep, '/')\n        self.body.append(f'<img src=\"{img_src}\"' + get_tooltip(self, node) +\n                         '/></p>\\n</div>')\n    raise nodes.SkipNode\n\n\ndef setup(app: Sphinx) -> dict[str, Any]:\n    app.add_html_math_renderer('imgmath',\n                               (html_visit_math, None),\n                               (html_visit_displaymath, None))\n\n    app.add_config_value('imgmath_image_format', 'png', 'html')\n    app.add_config_value('imgmath_dvipng', 'dvipng', 'html')\n    app.add_config_value('imgmath_dvisvgm', 'dvisvgm', 'html')\n    app.add_config_value('imgmath_latex', 'latex', 'html')\n    app.add_config_value('imgmath_use_preview', False, 'html')\n    app.add_config_value('imgmath_dvipng_args',\n                         ['-gamma', '1.5', '-D', '110', '-bg', 'Transparent'],\n                         'html')\n    app.add_config_value('imgmath_dvisvgm_args', ['--no-fonts'], 'html')\n    app.add_config_value('imgmath_latex_args', [], 'html')\n    app.add_config_value('imgmath_latex_preamble', '', 'html')\n    app.add_config_value('imgmath_add_tooltips', True, 'html')\n    app.add_config_value('imgmath_font_size', 12, 'html')\n    app.add_config_value('imgmath_embed', False, 'html', [bool])\n    app.connect('build-finished', clean_up_files)\n    return {'version': sphinx.__display_version__, 'parallel_read_safe': True}",
                "filename": "sphinx/ext/imgmath.py",
                "start_index": 12227,
                "end_index": 15116,
                "start_line": 342,
                "end_line": 401,
                "max_line": 401,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            },
            {
                "code": "app.add_builder(StandaloneHTMLBuilder)\n\n    # config values\n    app.add_config_value('html_theme', 'alabaster', 'html')\n    app.add_config_value('html_theme_path', [], 'html')\n    app.add_config_value('html_theme_options', {}, 'html')\n    app.add_config_value('html_title',\n                         lambda self: _('%s %s documentation') % (self.project, self.release),\n                         'html', [str])\n    app.add_config_value('html_short_title', lambda self: self.html_title, 'html')\n    app.add_config_value('html_style', None, 'html', [list, str])\n    app.add_config_value('html_logo', None, 'html', [str])\n    app.add_config_value('html_favicon', None, 'html', [str])\n    app.add_config_value('html_css_files', [], 'html')\n    app.add_config_value('html_js_files', [], 'html')\n    app.add_config_value('html_static_path', [], 'html')\n    app.add_config_value('html_extra_path', [], 'html')\n    app.add_config_value('html_last_updated_fmt', None, 'html', [str])\n    app.add_config_value('html_sidebars', {}, 'html')\n    app.add_config_value('html_additional_pages', {}, 'html')\n    app.add_config_value('html_domain_indices', True, 'html', [list])\n    app.add_config_value('html_permalinks', True, 'html')\n    app.add_config_value('html_permalinks_icon', '\u00b6', 'html')\n    app.add_config_value('html_use_index', True, 'html')\n    app.add_config_value('html_split_index', False, 'html')\n    app.add_config_value('html_copy_source', True, 'html')\n    app.add_config_value('html_show_sourcelink', True, 'html')\n    app.add_config_value('html_sourcelink_suffix', '.txt', 'html')\n    app.add_config_value('html_use_opensearch', '', 'html')\n    app.add_config_value('html_file_suffix', None, 'html', [str])\n    app.add_config_value('html_link_suffix', None, 'html', [str])\n    app.add_config_value('html_show_copyright', True, 'html')\n    app.add_config_value('html_show_search_summary', True, 'html')\n    app.add_config_value('html_show_sphinx', True, 'html')\n    app.add_config_value('html_context', {}, 'html')\n    app.add_config_value('html_output_encoding', 'utf-8', 'html')\n    app.add_config_value('html_compact_lists', True, 'html')\n    app.add_config_value('html_secnumber_suffix', '. ', 'html')\n    app.add_config_value('html_search_language', None, 'html', [str])\n    app.add_config_value('html_search_options', {}, 'html')\n    app.add_config_value('html_search_scorer', '', None)\n    app.add_config_value('html_scaled_image_link', True, 'html')\n    app.add_config_value('html_baseurl', '', 'html')\n    app.add_config_value('html_codeblock_linenos_style', 'inline', 'html',  # RemovedInSphinx70Warning  # noqa: E501\n                         ENUM('table', 'inline'))\n    app.add_config_value('html_math_renderer', None, 'env')\n    app.add_config_value('html4_writer', False, 'html')\n\n    # events\n    app.add_event('html-collect-pages')\n    app.add_event('html-page-context')\n\n    # event handlers\n    app.connect('config-inited', convert_html_css_files, priority=800)",
                "filename": "sphinx/builders/html/__init__.py",
                "start_index": 54344,
                "end_index": 57325,
                "start_line": 1320,
                "end_line": 1373,
                "max_line": 1395,
                "git_instance": "github",
                "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                "sha": ""
            }
        ],
        "classification": "feature request",
        "snippet_processor_task": {
            "sphinx/ext/linkcode.py": [
                {
                    "chunk": {
                        "code": "\"\"\"Add external links to module code in Python object descriptions.\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import Any\n\nfrom docutils import nodes\nfrom docutils.nodes import Node\n\nimport sphinx\nfrom sphinx import addnodes\nfrom sphinx.application import Sphinx\nfrom sphinx.errors import SphinxError\nfrom sphinx.locale import _\n\n\nclass LinkcodeError(SphinxError):\n    category = \"linkcode error\"\n\n\ndef doctree_read(app: Sphinx, doctree: Node) -> None:\n    env = app.builder.env\n\n    resolve_target = getattr(env.config, 'linkcode_resolve', None)\n    if not callable(env.config.linkcode_resolve):\n        raise LinkcodeError(\n            \"Function `linkcode_resolve` is not given in conf.py\")\n\n    domain_keys = {\n        'py': ['module', 'fullname'],\n        'c': ['names'],\n        'cpp': ['names'],\n        'js': ['object', 'fullname'],\n    }\n\n    for objnode in list(doctree.findall(addnodes.desc)):\n        domain = objnode.get('domain')\n        uris: set[str] = set()\n        for signode in objnode:\n            if not isinstance(signode, addnodes.desc_signature):\n                continue\n\n            # Convert signode to a specified format\n            info = {}\n            for key in domain_keys.get(domain, []):\n                value = signode.get(key)\n                if not value:\n                    value = ''\n                info[key] = value\n            if not info:\n                continue\n\n            # Call user code to resolve the link\n            uri = resolve_target(domain, info)\n            if not uri:\n                # no source\n                continue\n\n            if uri in uris or not uri:\n                # only one link per name, please\n                continue\n            uris.add(uri)\n\n            inline = nodes.inline('', _('[source]'), classes=['viewcode-link'])\n            onlynode = addnodes.only(expr='html')\n            onlynode += nodes.reference('', '', inline, internal=False, refuri=uri)\n            signode += onlynode\n\n\ndef setup(app: Sphinx) -> dict[str, Any]:\n    app.connect('doctree-read', doctree_read)\n    app.add_config_value('linkcode_resolve', None, '')\n    return {'version': sphinx.__display_version__, 'parallel_read_safe': True}",
                        "filename": "sphinx/ext/linkcode.py",
                        "start_index": 0,
                        "end_index": 2202,
                        "start_line": 1,
                        "end_line": 73,
                        "max_line": 73,
                        "git_instance": "github",
                        "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet is from 'sphinx/ext/linkcode.py' which is relevant because the issue mentions the need to customize links to source code, which is handled by the 'linkcode' extension."
                }
            ],
            "sphinx/builders/html/__init__.py": [
                {
                    "chunk": {
                        "code": "app.add_builder(StandaloneHTMLBuilder)\n\n    # config values\n    app.add_config_value('html_theme', 'alabaster', 'html')\n    app.add_config_value('html_theme_path', [], 'html')\n    app.add_config_value('html_theme_options', {}, 'html')\n    app.add_config_value('html_title',\n                         lambda self: _('%s %s documentation') % (self.project, self.release),\n                         'html', [str])\n    app.add_config_value('html_short_title', lambda self: self.html_title, 'html')\n    app.add_config_value('html_style', None, 'html', [list, str])\n    app.add_config_value('html_logo', None, 'html', [str])\n    app.add_config_value('html_favicon', None, 'html', [str])\n    app.add_config_value('html_css_files', [], 'html')\n    app.add_config_value('html_js_files', [], 'html')\n    app.add_config_value('html_static_path', [], 'html')\n    app.add_config_value('html_extra_path', [], 'html')\n    app.add_config_value('html_last_updated_fmt', None, 'html', [str])\n    app.add_config_value('html_sidebars', {}, 'html')\n    app.add_config_value('html_additional_pages', {}, 'html')\n    app.add_config_value('html_domain_indices', True, 'html', [list])\n    app.add_config_value('html_permalinks', True, 'html')\n    app.add_config_value('html_permalinks_icon', '\u00b6', 'html')\n    app.add_config_value('html_use_index', True, 'html')\n    app.add_config_value('html_split_index', False, 'html')\n    app.add_config_value('html_copy_source', True, 'html')\n    app.add_config_value('html_show_sourcelink', True, 'html')\n    app.add_config_value('html_sourcelink_suffix', '.txt', 'html')\n    app.add_config_value('html_use_opensearch', '', 'html')\n    app.add_config_value('html_file_suffix', None, 'html', [str])\n    app.add_config_value('html_link_suffix', None, 'html', [str])\n    app.add_config_value('html_show_copyright', True, 'html')\n    app.add_config_value('html_show_search_summary', True, 'html')\n    app.add_config_value('html_show_sphinx', True, 'html')\n    app.add_config_value('html_context', {}, 'html')\n    app.add_config_value('html_output_encoding', 'utf-8', 'html')\n    app.add_config_value('html_compact_lists', True, 'html')\n    app.add_config_value('html_secnumber_suffix', '. ', 'html')\n    app.add_config_value('html_search_language', None, 'html', [str])\n    app.add_config_value('html_search_options', {}, 'html')\n    app.add_config_value('html_search_scorer', '', None)\n    app.add_config_value('html_scaled_image_link', True, 'html')\n    app.add_config_value('html_baseurl', '', 'html')\n    app.add_config_value('html_codeblock_linenos_style', 'inline', 'html',  # RemovedInSphinx70Warning  # noqa: E501\n                         ENUM('table', 'inline'))\n    app.add_config_value('html_math_renderer', None, 'env')\n    app.add_config_value('html4_writer', False, 'html')\n\n    # events\n    app.add_event('html-collect-pages')\n    app.add_event('html-page-context')\n\n    # event handlers\n    app.connect('config-inited', convert_html_css_files, priority=800)",
                        "filename": "sphinx/builders/html/__init__.py",
                        "start_index": 54344,
                        "end_index": 57325,
                        "start_line": 1320,
                        "end_line": 1373,
                        "max_line": 1395,
                        "git_instance": "github",
                        "repo_name": "testbed/sphinx-doc__sphinx__3.5",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet is from 'sphinx/builders/html/__init__.py' and includes configuration options for HTML output, including 'html_permalinks' and 'html_permalinks_icon', which are directly related to the issue of customizing permalink HTML."
                }
            ]
        },
        "solution_task": "To implement the feature of allowing custom link texts for permalinks and links to source code in Sphinx, you can follow these steps:\n\n- Add two new configuration options in the Sphinx configuration file (`conf.py`):\n  - `html_add_permalinks_html`: This option will allow users to specify HTML content for permalinks.\n  - `viewcode_source_html`: This option will allow users to specify HTML content for source code links generated by the `viewcode` extension.\n\n- Modify the HTML writer to use these new configuration options when generating permalinks and source code links.\n\nHere's a high-level overview of the changes needed in the code:\n\n1. Update the Sphinx configuration (`conf.py`) to include the new options:\n   ```python\n   html_add_permalinks_html = '<i class=\"fa fa-link\"></i>'\n   viewcode_source_html = '<span class=\"viewcode-link\"><i class=\"fa fa-code\"></i></span>'\n   ```\n\n2. Modify the HTML writer to check for these options and use them when generating links. This will likely involve changes in the `sphinx/writers/html.py` or a similar file where the HTML output is generated.\n\n3. For permalinks, you will need to find the part of the code that generates the permalink HTML and replace the text content with the value from `html_add_permalinks_html`.\n\n4. For source code links, you will need to modify the `doctree_read` function in `sphinx/ext/linkcode.py` to use `viewcode_source_html` when creating the `nodes.reference` for the source code link.\n\n5. Ensure that the new configuration options are properly documented and that they are optional, with sensible defaults that preserve the current behavior if the options are not set.\n\n6. Write tests to verify that the new feature works as expected.\n\nHere's a simplified example of how you might modify the permalink generation:\n\n```python\n# In the HTML writer code where permalinks are generated\nif hasattr(self.builder.config, 'html_add_permalinks_html'):\n    permalink_html = self.builder.config.html_add_permalinks_html\n    # Generate the permalink using permalink_html instead of the default text\nelse:\n    # Fallback to the default behavior\n```\n\nAnd for the source code links:\n\n```python\n# In the doctree_read function of linkcode.py\nif hasattr(env.config, 'viewcode_source_html'):\n    link_content = env.config.viewcode_source_html\n    # Create the reference node using link_content as the HTML content\nelse:\n    # Fallback to the default behavior\n```\n\nPlease note that the actual implementation will require a detailed understanding of the Sphinx codebase and how it generates HTML output. The above code is a simplified representation and may not work without proper integration into the Sphinx framework.",
        "bouncer_response": {
            "score": 7,
            "criteria": "RESPONSE must provide actionable, relevant guidance to more parts of the PROMPT's described issue to score higher.",
            "supporting_evidence": "The RESPONSE provides a clear and actionable plan for implementing the feature request to allow custom link texts for permalinks and links to source code in Sphinx. It suggests adding two new configuration options in the Sphinx configuration file and modifying the HTML writer to use these options. The RESPONSE also includes a high-level overview of the changes needed in the code, specific code snippets for modifying the permalink generation and source code links, and a note on the importance of documentation and testing. The RESPONSE is relevant and provides actionable guidance, but it does not address the potential complexities of integrating the new feature into the Sphinx framework or the need for a new node type as mentioned in the PROMPT. Therefore, it is not comprehensive enough to score a 10, but it does offer substantial guidance that would aid in the development of the feature.",
            "clarification_questions": "NONE"
        },
        "end_time": 1711703240.351321,
        "result": "To implement the feature of allowing custom link texts for permalinks and links to source code in Sphinx, you can follow these steps:\n\n- Add two new configuration options in the Sphinx configuration file (`conf.py`):\n  - `html_add_permalinks_html`: This option will allow users to specify HTML content for permalinks.\n  - `viewcode_source_html`: This option will allow users to specify HTML content for source code links generated by the `viewcode` extension.\n\n- Modify the HTML writer to use these new configuration options when generating permalinks and source code links.\n\nHere's a high-level overview of the changes needed in the code:\n\n1. Update the Sphinx configuration (`conf.py`) to include the new options:\n   ```python\n   html_add_permalinks_html = '<i class=\"fa fa-link\"></i>'\n   viewcode_source_html = '<span class=\"viewcode-link\"><i class=\"fa fa-code\"></i></span>'\n   ```\n\n2. Modify the HTML writer to check for these options and use them when generating links. This will likely involve changes in the `sphinx/writers/html.py` or a similar file where the HTML output is generated.\n\n3. For permalinks, you will need to find the part of the code that generates the permalink HTML and replace the text content with the value from `html_add_permalinks_html`.\n\n4. For source code links, you will need to modify the `doctree_read` function in `sphinx/ext/linkcode.py` to use `viewcode_source_html` when creating the `nodes.reference` for the source code link.\n\n5. Ensure that the new configuration options are properly documented and that they are optional, with sensible defaults that preserve the current behavior if the options are not set.\n\n6. Write tests to verify that the new feature works as expected.\n\nHere's a simplified example of how you might modify the permalink generation:\n\n```python\n# In the HTML writer code where permalinks are generated\nif hasattr(self.builder.config, 'html_add_permalinks_html'):\n    permalink_html = self.builder.config.html_add_permalinks_html\n    # Generate the permalink using permalink_html instead of the default text\nelse:\n    # Fallback to the default behavior\n```\n\nAnd for the source code links:\n\n```python\n# In the doctree_read function of linkcode.py\nif hasattr(env.config, 'viewcode_source_html'):\n    link_content = env.config.viewcode_source_html\n    # Create the reference node using link_content as the HTML content\nelse:\n    # Fallback to the default behavior\n```\n\nPlease note that the actual implementation will require a detailed understanding of the Sphinx codebase and how it generates HTML output. The above code is a simplified representation and may not work without proper integration into the Sphinx framework.\n\n### Code snippets to check\n\n-  \u2192 [sphinx](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx) \u2192 [ext](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/ext)- [Lines 1 - 73](https://github.com/testbed/sphinx-doc__sphinx__3.5/blob//sphinx/ext/linkcode.py#L1-L73)\n\n This snippet is from 'sphinx/ext/linkcode.py' which is relevant because the issue mentions the need to customize links to source code, which is handled by the 'linkcode' extension.\n-  \u2192 [sphinx](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx) \u2192 [builders](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/builders) \u2192 [html](https://github.com/testbed/sphinx-doc__sphinx__3.5/tree//sphinx/builders/html)- [Lines 1320 - 1373](https://github.com/testbed/sphinx-doc__sphinx__3.5/blob//sphinx/builders/html/__init__.py#L1320-L1373)\n\n This snippet is from 'sphinx/builders/html/__init__.py' and includes configuration options for HTML output, including 'html_permalinks' and 'html_permalinks_icon', which are directly related to the issue of customizing permalink HTML."
    }
}