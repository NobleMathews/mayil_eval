{
    "id": "matplotlib__matplotlib-21318",
    "repo_name": "testbed/matplotlib__matplotlib__3.4",
    "task_id": 3237012185888112023,
    "title": "RuntimeError: adjustable='datalim' is not allowed when both axes are shared.",
    "body": "<!--To help us understand and resolve your issue, please fill out the form to the best of your ability.-->\r\n<!--You can feel free to delete the sections that do not apply.-->\r\n\r\n### Bug report\r\n\r\n**Bug summary**\r\n\r\nMatplotlib 2.2.2 fails to plot the figure described below. The code works with Matplotlib 2.0.2.\r\n\r\nThe issue seems to be the combination of ``sharex=True, sharey=True`` and ``axis('equal')``.\r\n\r\n**Code for reproduction**\r\n\r\n```python\r\nimport matplotlib.pyplot as plt\r\nimport numpy as np\r\n\r\nnrows = 3\r\nncols = 2\r\nfig, axes = plt.subplots(ncols=ncols, nrows=nrows, sharex=True, sharey=True)\r\n\r\nn = 20\r\nnp.random.seed(1234)\r\ndata = np.random.uniform(size=(nrows, ncols, n, n))\r\n\r\nfor i in range(nrows):\r\n    for j in range(ncols):\r\n        ax = axes[i, j]\r\n        ax.imshow(data[i, j])\r\n        ax.axis(\"equal\")\r\n\r\nplt.show()\r\n\r\n```\r\n\r\n**Actual outcome**\r\n\r\nWith Matplotlib 2.2.2, the figure is not drawn and the following exception is raised:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\backends\\backend_qt5.py\", line 519, in _draw_idle\r\n    self.draw()\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\backends\\backend_agg.py\", line 433, in draw\r\n    self.figure.draw(self.renderer)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\artist.py\", line 55, in draw_wrapper\r\n    return draw(artist, renderer, *args, **kwargs)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\figure.py\", line 1475, in draw\r\n    renderer, self, artists, self.suppressComposite)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\image.py\", line 141, in _draw_list_compositing_images\r\n    a.draw(renderer)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\artist.py\", line 55, in draw_wrapper\r\n    return draw(artist, renderer, *args, **kwargs)\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\axes\\_base.py\", line 2546, in draw\r\n    self.apply_aspect()\r\n  File \"C:\\ProgramData\\Anaconda3\\lib\\site-packages\\matplotlib\\axes\\_base.py\", line 1631, in apply_aspect\r\n    raise RuntimeError(\"adjustable='datalim' is not allowed when both\"\r\nRuntimeError: adjustable='datalim' is not allowed when both axes are shared.\r\n```\r\n\r\n**Expected outcome**\r\n\r\nDrawn figure, no error, as with Matplotlib 2.0.2\r\n\r\n\r\n**Matplotlib version**\r\n<!--Please specify your platform and versions of the relevant libraries you are using:-->\r\n  * Operating system: Windows 7 64 bits\r\n  * Matplotlib version: 2.2.2\r\n  * Matplotlib backend (`print(matplotlib.get_backend())`): Qt5Agg\r\n  * Python version: 3.6\r\n  * Jupyter version (if applicable):\r\n  * Other libraries: Anaconda 5.2\r\n\r\n<!--Please tell us how you installed matplotlib and python e.g., from source, pip, conda-->\r\n<!--If you installed from conda, please specify which channel you used if not the default-->\r\n\r\n\n",
    "state": "closed",
    "repo_link": "https://github.com/testbed/matplotlib__matplotlib__3.4.git",
    "requested_commit": "",
    "mayil_response": "- Remove the `ax.axis(\"equal\")` line from your code, as it is incompatible with shared axes in Matplotlib version 2.2.2.\n- Alternatively, if maintaining an equal aspect ratio is essential, consider not sharing both axes by setting either `sharex=False` or `sharey=False` in the `plt.subplots` call.\n\n### Code snippets to check\n\n-  \u2192 [lib](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib) \u2192 [matplotlib](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib/matplotlib) \u2192 [axes](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib/matplotlib/axes)- [Lines 35 - 4442](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//lib/matplotlib/axes/_base.py#L35-L4442)\n\n This snippet contains a condition that raises a ValueError when both axes are shared and not equal to self, which is related to the issue of shared axes.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 1 - 35](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/axis_equal_demo.py#L1-L35)\n\n This snippet demonstrates the use of 'axis('equal')' which is part of the issue when combined with shared axes.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 1 - 57](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/shared_axis_demo.py#L1-L57)\n\n This snippet shows an example of sharing axes which is relevant to the issue, although it does not directly address the 'axis('equal')' part.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 105 - 205](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/subplots_demo.py#L105-L205)\n\n This snippet includes examples of sharing axes and might contain relevant information for debugging the issue.",
    "ai_cost": {
        "search_embedding": 1.3e-07,
        "issue_classifier": 0.0035714999999999996,
        "snippet_processor": 0.16102,
        "issue_star_creation": 0.09400000000000001,
        "issue_star_solver": 0.10120000000000001,
        "bouncer": 0.08831000000000001
    },
    "mayil_collected_data": {
        "status": "completed",
        "start_time": 1711698538.249439,
        "relevant_snippets": [
            {
                "code": "\"\n        if 'sharex' in kwargs and 'sharey' in kwargs:\n            # The following line is added in v2.2 to avoid breaking Seaborn,\n            # which currently uses this internal API.\n            if kwargs[\"sharex\"] is not self and kwargs[\"sharey\"] is not self:\n                raise ValueError(\"Twinned Axes may share only one axis\")",
                "filename": "lib/matplotlib/axes/_base.py",
                "start_index": 168389,
                "end_index": 168726,
                "start_line": 35,
                "end_line": 4442,
                "max_line": 4654,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n==========\nAxes Grid2\n==========\n\nGrid of images with shared xaxis and yaxis.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nfrom matplotlib import cbook\nfrom mpl_toolkits.axes_grid1 import ImageGrid\n\n\ndef add_inner_title(ax, title, loc, **kwargs):\n    from matplotlib.offsetbox import AnchoredText\n    from matplotlib.patheffects import withStroke\n    prop = dict(path_effects=[withStroke(foreground='w', linewidth=3)],\n                size=plt.rcParams['legend.fontsize'])\n    at = AnchoredText(title, loc=loc, prop=prop,\n                      pad=0., borderpad=0.5,\n                      frameon=False, **kwargs)\n    ax.add_artist(at)\n    return at\n\n\nfig = plt.figure(figsize=(6, 6))\n\n# Prepare images\nZ = cbook.get_sample_data(\"axes_grid/bivariate_normal.npy\")\nextent = (-3, 4, -4, 3)\nZS = [Z[i::3, :] for i in range(3)]\nextent = extent[0], extent[1]/3., extent[2], extent[3]\n\n# *** Demo 1: colorbar at each axes ***\ngrid = ImageGrid(\n    # 211 = at the position of fig.add_subplot(211)\n    fig, 211, nrows_ncols=(1, 3), axes_pad=0.05, label_mode=\"1\", share_all=True,\n    cbar_location=\"top\", cbar_mode=\"each\", cbar_size=\"7%\", cbar_pad=\"1%\")\ngrid[0].set(xticks=[-2, 0], yticks=[-2, 0, 2])\n\nfor i, (ax, z) in enumerate(zip(grid, ZS)):\n    im = ax.imshow(z, origin=\"lower\", extent=extent)\n    cb = ax.cax.colorbar(im)\n    # Changing the colorbar ticks\n    if i in [1, 2]:\n        cb.set_ticks([-1, 0, 1])\n\nfor ax, im_title in zip(grid, [\"Image 1\", \"Image 2\", \"Image 3\"]):\n    add_inner_title(ax, im_title, loc='lower left')\n\n# *** Demo 2: shared colorbar ***\ngrid2 = ImageGrid(\n    fig, 212, nrows_ncols=(1, 3), axes_pad=0.05, label_mode=\"1\", share_all=True,\n    cbar_location=\"right\", cbar_mode=\"single\", cbar_size=\"10%\", cbar_pad=0.05)\ngrid2[0].set(xlabel=\"X\", ylabel=\"Y\", xticks=[-2, 0], yticks=[-2, 0, 2])\n\nclim = (np.min(ZS), np.max(ZS))\nfor ax, z in zip(grid2, ZS):\n    im = ax.imshow(z, clim=clim, origin=\"lower\", extent=extent)\n\n# With cbar_mode=\"single\", cax attribute of all axes are identical.\nax.cax.colorbar(im)\n\nfor ax, im_title in zip(grid2, [\"(a)\", \"(b)\", \"(c)\"]):\n    add_inner_title(ax, im_title, loc='upper left')\n\nplt.show()",
                "filename": "galleries/examples/axes_grid1/demo_axes_grid2.py",
                "start_index": 0,
                "end_index": 2160,
                "start_line": 1,
                "end_line": 69,
                "max_line": 69,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n===========\nShared axis\n===========\n\nYou can share the x- or y-axis limits for one axis with another by\npassing an `~.axes.Axes` instance as a *sharex* or *sharey* keyword argument.\n\nChanging the axis limits on one axes will be reflected automatically\nin the other, and vice-versa, so when you navigate with the toolbar\nthe Axes will follow each other on their shared axis.  Ditto for\nchanges in the axis scaling (e.g., log vs. linear).  However, it is\npossible to have differences in tick labeling, e.g., you can selectively\nturn off the tick labels on one Axes.\n\nThe example below shows how to customize the tick labels on the\nvarious axes.  Shared axes share the tick locator, tick formatter,\nview limits, and transformation (e.g., log, linear).  But the ticklabels\nthemselves do not share properties.  This is a feature and not a bug,\nbecause you may want to make the tick labels smaller on the upper\naxes, e.g., in the example below.\n\nIf you want to turn off the ticklabels for a given Axes (e.g., on\nsubplot(211) or subplot(212)), you cannot do the standard trick::\n\n   setp(ax2, xticklabels=[])\n\nbecause this changes the tick Formatter, which is shared among all\nAxes.  But you can alter the visibility of the labels, which is a\nproperty::\n\n  setp(ax2.get_xticklabels(), visible=False)\n\n\"\"\"\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nt = np.arange(0.01, 5.0, 0.01)\ns1 = np.sin(2 * np.pi * t)\ns2 = np.exp(-t)\ns3 = np.sin(4 * np.pi * t)\n\nax1 = plt.subplot(311)\nplt.plot(t, s1)\nplt.tick_params('x', labelsize=6)\n\n# share x only\nax2 = plt.subplot(312, sharex=ax1)\nplt.plot(t, s2)\n# make these tick labels invisible\nplt.tick_params('x', labelbottom=False)\n\n# share x and y\nax3 = plt.subplot(313, sharex=ax1, sharey=ax1)\nplt.plot(t, s3)\nplt.xlim(0.01, 5.0)\nplt.show()",
                "filename": "galleries/examples/subplots_axes_and_figures/shared_axis_demo.py",
                "start_index": 0,
                "end_index": 1781,
                "start_line": 1,
                "end_line": 57,
                "max_line": 57,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n=======================\nEqual axis aspect ratio\n=======================\n\nHow to set and adjust plots with equal axis aspect ratios.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# Plot circle of radius 3.\n\nan = np.linspace(0, 2 * np.pi, 100)\nfig, axs = plt.subplots(2, 2)\n\naxs[0, 0].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[0, 0].set_title('not equal, looks like ellipse', fontsize=10)\n\naxs[0, 1].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[0, 1].axis('equal')\naxs[0, 1].set_title('equal, looks like circle', fontsize=10)\n\naxs[1, 0].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[1, 0].axis('equal')\naxs[1, 0].set(xlim=(-3, 3), ylim=(-3, 3))\naxs[1, 0].set_title('still a circle, even after changing limits', fontsize=10)\n\naxs[1, 1].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[1, 1].set_aspect('equal', 'box')\naxs[1, 1].set_title('still a circle, auto-adjusted data limits', fontsize=10)\n\nfig.tight_layout()\n\nplt.show()",
                "filename": "galleries/examples/subplots_axes_and_figures/axis_equal_demo.py",
                "start_index": 0,
                "end_index": 921,
                "start_line": 1,
                "end_line": 35,
                "max_line": 35,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "name: Bug Report\ndescription: Report a bug or issue with Matplotlib.\ntitle: \"[Bug]: \"\nbody:\n  - type: textarea\n    id: summary\n    attributes:\n      label: Bug summary\n      description:  Describe the bug in 1-2 short sentences\n      placeholder:\n      value:\n    validations:\n      required: true\n  - type: textarea\n    id: reproduction\n    attributes:\n      label: Code for reproduction\n      description: |\n        If possible, please provide a minimum self-contained example.\n      placeholder: Paste your code here. This field is automatically formatted as Python code.\n      render: python\n    validations:\n      required: true\n  - type: textarea\n    id: actual\n    attributes:\n      label: Actual outcome\n      description: |\n        Paste the output produced by the code provided above, e.g.\n        console output, images/videos produced by the code, any relevant screenshots/screencasts, etc.\n    validations:\n      required: true\n  - type: textarea\n    id: expected\n    attributes:\n      label: Expected outcome\n      description: Describe (or provide a visual example of) the expected outcome from the code snippet.\n    validations:\n      required: true\n  - type: textarea\n    id: details\n    attributes:\n      label: Additional information\n      description: |\n        - What are the conditions under which this bug happens? input parameters, edge cases, etc?\n        - Has this worked in earlier versions?\n        - Do you know why this bug is happening?\n        - Do you maybe even know a fix?\n  - type: input\n    id: operating-system\n    attributes:\n      label: Operating system\n      description: Windows, OS/X, Arch, Debian, Ubuntu, etc.\n  - type: input\n    id: matplotlib-version\n    attributes:\n      label: Matplotlib Version\n      description: \"From Python prompt: `import matplotlib; print(matplotlib.__version__)`\"\n    validations:\n      required: true\n  - type: input\n    id: matplotlib-backend\n    attributes:\n      label: Matplotlib Backend\n      description: \"From Python prompt: `import matplotlib; print(matplotlib.get_backend())`\"\n  - type: input\n    id: python-version\n    attributes:\n      label: Python version\n      description: \"In console: `python --version`\"\n  - type: input\n    id: jupyter-version\n    attributes:\n      label: Jupyter version\n      description: \"In console: `jupyter notebook --version` or `jupyter lab --version`\"\n  - type: dropdown\n    id: install\n    attributes:\n      label: Installation\n      description: How did you install matplotlib?\n      options:\n        - pip\n        - conda\n        - Linux package manager\n        - from source (.tar.gz)\n        - git checkout",
                "filename": ".github/ISSUE_TEMPLATE/bug_report.yml",
                "start_index": 0,
                "end_index": 2631,
                "start_line": 1,
                "end_line": 86,
                "max_line": 86,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n=============================\n2D and 3D axes in same figure\n=============================\n\nThis example shows a how to plot a 2D and a 3D plot on the same figure.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n\ndef f(t):\n    return np.cos(2*np.pi*t) * np.exp(-t)\n\n\n# Set up a figure twice as tall as it is wide\nfig = plt.figure(figsize=plt.figaspect(2.))\nfig.suptitle('A tale of 2 subplots')\n\n# First subplot\nax = fig.add_subplot(2, 1, 1)\n\nt1 = np.arange(0.0, 5.0, 0.1)\nt2 = np.arange(0.0, 5.0, 0.02)\nt3 = np.arange(0.0, 2.0, 0.01)\n\nax.plot(t1, f(t1), 'bo',\n        t2, f(t2), 'k--', markerfacecolor='green')\nax.grid(True)\nax.set_ylabel('Damped oscillation')\n\n# Second subplot\nax = fig.add_subplot(2, 1, 2, projection='3d')\n\nX = np.arange(-5, 5, 0.25)\nY = np.arange(-5, 5, 0.25)\nX, Y = np.meshgrid(X, Y)\nR = np.sqrt(X**2 + Y**2)\nZ = np.sin(R)\n\nsurf = ax.plot_surface(X, Y, Z, rstride=1, cstride=1,\n                       linewidth=0, antialiased=False)\nax.set_zlim(-1, 1)\n\nplt.show()",
                "filename": "galleries/examples/mplot3d/mixed_subplots.py",
                "start_index": 0,
                "end_index": 997,
                "start_line": 1,
                "end_line": 46,
                "max_line": 46,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "ax4.plot(x, -y**2, 'tab:red')\n\nfor ax in fig.get_axes():\n    ax.label_outer()\n\n# %%\n# Sharing axes\n# \"\"\"\"\"\"\"\"\"\"\"\"\n#\n# By default, each Axes is scaled individually. Thus, if the ranges are\n# different the tick values of the subplots do not align.\n\nfig, (ax1, ax2) = plt.subplots(2)\nfig.suptitle('Axes values are scaled individually by default')\nax1.plot(x, y)\nax2.plot(x + 1, -y)\n\n# %%\n# You can use *sharex* or *sharey* to align the horizontal or vertical axis.\n\nfig, (ax1, ax2) = plt.subplots(2, sharex=True)\nfig.suptitle('Aligning x-axis using sharex')\nax1.plot(x, y)\nax2.plot(x + 1, -y)\n\n# %%\n# Setting *sharex* or *sharey* to ``True`` enables global sharing across the\n# whole grid, i.e. also the y-axes of vertically stacked subplots have the\n# same scale when using ``sharey=True``.\n\nfig, axs = plt.subplots(3, sharex=True, sharey=True)\nfig.suptitle('Sharing both axes')\naxs[0].plot(x, y ** 2)\naxs[1].plot(x, 0.3 * y, 'o')\naxs[2].plot(x, y, '+')\n\n# %%\n# For subplots that are sharing axes one set of tick labels is enough. Tick\n# labels of inner Axes are automatically removed by *sharex* and *sharey*.\n# Still there remains an unused empty space between the subplots.\n#\n# To precisely control the positioning of the subplots, one can explicitly\n# create a `.GridSpec` with `.Figure.add_gridspec`, and then call its\n# `~.GridSpecBase.subplots` method.  For example, we can reduce the height\n# between vertical subplots using ``add_gridspec(hspace=0)``.\n#\n# `.label_outer` is a handy method to remove labels and ticks from subplots\n# that are not at the edge of the grid.\n\nfig = plt.figure()\ngs = fig.add_gridspec(3, hspace=0)\naxs = gs.subplots(sharex=True, sharey=True)\nfig.suptitle('Sharing both axes')\naxs[0].plot(x, y ** 2)\naxs[1].plot(x, 0.3 * y, 'o')\naxs[2].plot(x, y, '+')\n\n# Hide x labels and tick labels for all but bottom plot.\nfor ax in axs:\n    ax.label_outer()\n\n# %%\n# Apart from ``True`` and ``False``, both *sharex* and *sharey* accept the\n# values 'row' and 'col' to share the values only per row or column.\n\nfig = plt.figure()\ngs = fig.add_gridspec(2, 2, hspace=0, wspace=0)\n(ax1, ax2), (ax3, ax4) = gs.subplots(sharex='col', sharey='row')\nfig.suptitle('Sharing x per column, y per row')\nax1.plot(x, y)\nax2.plot(x, y**2, 'tab:orange')\nax3.plot(x + 1, -y, 'tab:green')\nax4.plot(x + 2, -y**2, 'tab:red')\n\nfor ax in fig.get_axes():\n    ax.label_outer()\n\n# %%\n# If you want a more complex sharing structure, you can first create the\n# grid of axes with no sharing, and then call `.axes.Axes.sharex` or\n# `.axes.Axes.sharey` to add sharing info a posteriori.\n\nfig, axs = plt.subplots(2, 2)\naxs[0, 0].plot(x, y)\naxs[0, 0].set_title(\"main\")\naxs[1, 0].plot(x, y**2)\naxs[1, 0].set_title(\"shares x with main\")\naxs[1, 0].sharex(axs[0, 0])\naxs[0, 1].plot(x + 1, y + 1)\naxs[0, 1].set_title(\"unrelated\")\naxs[1, 1].plot(x + 2, y + 2)\naxs[1, 1].set_title(\"also unrelated\")\nfig.tight_layout()\n\n# %%\n# Polar axes\n# \"\"\"\"\"\"\"\"\"\"\n#",
                "filename": "galleries/examples/subplots_axes_and_figures/subplots_demo.py",
                "start_index": 2986,
                "end_index": 5917,
                "start_line": 105,
                "end_line": 205,
                "max_line": 211,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n===========\nBroken Axis\n===========\n\nBroken axis example, where the y-axis will have a portion cut out.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nnp.random.seed(19680801)\n\npts = np.random.rand(30)*.2\n# Now let's make two outlier points which are far away from everything.\npts[[3, 14]] += .8\n\n# If we were to simply plot pts, we'd lose most of the interesting\n# details due to the outliers. So let's 'break' or 'cut-out' the y-axis\n# into two portions - use the top (ax1) for the outliers, and the bottom\n# (ax2) for the details of the majority of our data\nfig, (ax1, ax2) = plt.subplots(2, 1, sharex=True)\nfig.subplots_adjust(hspace=0.05)  # adjust space between axes\n\n# plot the same data on both axes\nax1.plot(pts)\nax2.plot(pts)\n\n# zoom-in / limit the view to different portions of the data\nax1.set_ylim(.78, 1.)  # outliers only\nax2.set_ylim(0, .22)  # most of the data\n\n# hide the spines between ax and ax2\nax1.spines.bottom.set_visible(False)\nax2.spines.top.set_visible(False)\nax1.xaxis.tick_top()\nax1.tick_params(labeltop=False)  # don't put tick labels at the top\nax2.xaxis.tick_bottom()\n\n# Now, let's turn towards the cut-out slanted lines.\n# We create line objects in axes coordinates, in which (0,0), (0,1),\n# (1,0), and (1,1) are the four corners of the axes.\n# The slanted lines themselves are markers at those locations, such that the\n# lines keep their angle and position, independent of the axes size or scale\n# Finally, we need to disable clipping.\n\nd = .5  # proportion of vertical to horizontal extent of the slanted line\nkwargs = dict(marker=[(-1, -d), (1, d)], markersize=12,\n              linestyle=\"none\", color='k', mec='k', mew=1, clip_on=False)\nax1.plot([0, 1], [0, 0], transform=ax1.transAxes, **kwargs)\nax2.plot([0, 1], [1, 1], transform=ax2.transAxes, **kwargs)\n\n\nplt.show()",
                "filename": "galleries/examples/subplots_axes_and_figures/broken_axis.py",
                "start_index": 0,
                "end_index": 1821,
                "start_line": 1,
                "end_line": 54,
                "max_line": 54,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\nSharing axis limits and views\n=============================\n\nIt's common to make two or more plots which share an axis, e.g., two subplots\nwith time as a common axis.  When you pan and zoom around on one, you want the\nother to move around with you.  To facilitate this, matplotlib Axes support a\n``sharex`` and ``sharey`` attribute.  When you create a `~.pyplot.subplot` or\n`~.pyplot.axes`, you can pass in a keyword indicating what axes you want to\nshare with.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nt = np.arange(0, 10, 0.01)\n\nax1 = plt.subplot(211)\nax1.plot(t, np.sin(2*np.pi*t))\n\nax2 = plt.subplot(212, sharex=ax1)\nax2.plot(t, np.sin(4*np.pi*t))\n\nplt.show()",
                "filename": "galleries/examples/subplots_axes_and_figures/share_axis_lims_views.py",
                "start_index": 0,
                "end_index": 683,
                "start_line": 1,
                "end_line": 24,
                "max_line": 24,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            },
            {
                "code": "\"\"\"\n===========================\nPlots with different scales\n===========================\n\nTwo plots on the same axes with different left and right scales.\n\nThe trick is to use *two different axes* that share the same *x* axis.\nYou can use separate `matplotlib.ticker` formatters and locators as\ndesired since the two axes are independent.\n\nSuch axes are generated by calling the `.Axes.twinx` method. Likewise,\n`.Axes.twiny` is available to generate axes that share a *y* axis but\nhave different top and bottom scales.\n\"\"\"\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# Create some mock data\nt = np.arange(0.01, 10.0, 0.01)\ndata1 = np.exp(t)\ndata2 = np.sin(2 * np.pi * t)\n\nfig, ax1 = plt.subplots()\n\ncolor = 'tab:red'\nax1.set_xlabel('time (s)')\nax1.set_ylabel('exp', color=color)\nax1.plot(t, data1, color=color)\nax1.tick_params(axis='y', labelcolor=color)\n\nax2 = ax1.twinx()  # instantiate a second axes that shares the same x-axis\n\ncolor = 'tab:blue'\nax2.set_ylabel('sin', color=color)  # we already handled the x-label with ax1\nax2.plot(t, data2, color=color)\nax2.tick_params(axis='y', labelcolor=color)\n\nfig.tight_layout()  # otherwise the right y-label is slightly clipped\nplt.show()\n\n# %%\n#\n# .. admonition:: References\n#\n#    The use of the following functions, methods, classes and modules is shown\n#    in this example:\n#\n#    - `matplotlib.axes.Axes.twinx` / `matplotlib.pyplot.twinx`\n#    - `matplotlib.axes.Axes.twiny` / `matplotlib.pyplot.twiny`\n#    - `matplotlib.axes.Axes.tick_params` / `matplotlib.pyplot.tick_params`",
                "filename": "galleries/examples/subplots_axes_and_figures/two_scales.py",
                "start_index": 0,
                "end_index": 1539,
                "start_line": 1,
                "end_line": 51,
                "max_line": 51,
                "git_instance": "github",
                "repo_name": "testbed/matplotlib__matplotlib__3.4",
                "sha": ""
            }
        ],
        "classification": "bug",
        "snippet_processor_task": {
            "lib/matplotlib/axes/_base.py": [
                {
                    "chunk": {
                        "code": "\"\n        if 'sharex' in kwargs and 'sharey' in kwargs:\n            # The following line is added in v2.2 to avoid breaking Seaborn,\n            # which currently uses this internal API.\n            if kwargs[\"sharex\"] is not self and kwargs[\"sharey\"] is not self:\n                raise ValueError(\"Twinned Axes may share only one axis\")",
                        "filename": "lib/matplotlib/axes/_base.py",
                        "start_index": 168389,
                        "end_index": 168726,
                        "start_line": 35,
                        "end_line": 4442,
                        "max_line": 4654,
                        "git_instance": "github",
                        "repo_name": "testbed/matplotlib__matplotlib__3.4",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet contains a condition that raises a ValueError when both axes are shared and not equal to self, which is related to the issue of shared axes."
                }
            ],
            "galleries/examples/subplots_axes_and_figures/axis_equal_demo.py": [
                {
                    "chunk": {
                        "code": "\"\"\"\n=======================\nEqual axis aspect ratio\n=======================\n\nHow to set and adjust plots with equal axis aspect ratios.\n\"\"\"\n\nimport matplotlib.pyplot as plt\nimport numpy as np\n\n# Plot circle of radius 3.\n\nan = np.linspace(0, 2 * np.pi, 100)\nfig, axs = plt.subplots(2, 2)\n\naxs[0, 0].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[0, 0].set_title('not equal, looks like ellipse', fontsize=10)\n\naxs[0, 1].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[0, 1].axis('equal')\naxs[0, 1].set_title('equal, looks like circle', fontsize=10)\n\naxs[1, 0].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[1, 0].axis('equal')\naxs[1, 0].set(xlim=(-3, 3), ylim=(-3, 3))\naxs[1, 0].set_title('still a circle, even after changing limits', fontsize=10)\n\naxs[1, 1].plot(3 * np.cos(an), 3 * np.sin(an))\naxs[1, 1].set_aspect('equal', 'box')\naxs[1, 1].set_title('still a circle, auto-adjusted data limits', fontsize=10)\n\nfig.tight_layout()\n\nplt.show()",
                        "filename": "galleries/examples/subplots_axes_and_figures/axis_equal_demo.py",
                        "start_index": 0,
                        "end_index": 921,
                        "start_line": 1,
                        "end_line": 35,
                        "max_line": 35,
                        "git_instance": "github",
                        "repo_name": "testbed/matplotlib__matplotlib__3.4",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet demonstrates the use of 'axis('equal')' which is part of the issue when combined with shared axes."
                }
            ],
            "galleries/examples/subplots_axes_and_figures/shared_axis_demo.py": [
                {
                    "chunk": {
                        "code": "\"\"\"\n===========\nShared axis\n===========\n\nYou can share the x- or y-axis limits for one axis with another by\npassing an `~.axes.Axes` instance as a *sharex* or *sharey* keyword argument.\n\nChanging the axis limits on one axes will be reflected automatically\nin the other, and vice-versa, so when you navigate with the toolbar\nthe Axes will follow each other on their shared axis.  Ditto for\nchanges in the axis scaling (e.g., log vs. linear).  However, it is\npossible to have differences in tick labeling, e.g., you can selectively\nturn off the tick labels on one Axes.\n\nThe example below shows how to customize the tick labels on the\nvarious axes.  Shared axes share the tick locator, tick formatter,\nview limits, and transformation (e.g., log, linear).  But the ticklabels\nthemselves do not share properties.  This is a feature and not a bug,\nbecause you may want to make the tick labels smaller on the upper\naxes, e.g., in the example below.\n\nIf you want to turn off the ticklabels for a given Axes (e.g., on\nsubplot(211) or subplot(212)), you cannot do the standard trick::\n\n   setp(ax2, xticklabels=[])\n\nbecause this changes the tick Formatter, which is shared among all\nAxes.  But you can alter the visibility of the labels, which is a\nproperty::\n\n  setp(ax2.get_xticklabels(), visible=False)\n\n\"\"\"\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nt = np.arange(0.01, 5.0, 0.01)\ns1 = np.sin(2 * np.pi * t)\ns2 = np.exp(-t)\ns3 = np.sin(4 * np.pi * t)\n\nax1 = plt.subplot(311)\nplt.plot(t, s1)\nplt.tick_params('x', labelsize=6)\n\n# share x only\nax2 = plt.subplot(312, sharex=ax1)\nplt.plot(t, s2)\n# make these tick labels invisible\nplt.tick_params('x', labelbottom=False)\n\n# share x and y\nax3 = plt.subplot(313, sharex=ax1, sharey=ax1)\nplt.plot(t, s3)\nplt.xlim(0.01, 5.0)\nplt.show()",
                        "filename": "galleries/examples/subplots_axes_and_figures/shared_axis_demo.py",
                        "start_index": 0,
                        "end_index": 1781,
                        "start_line": 1,
                        "end_line": 57,
                        "max_line": 57,
                        "git_instance": "github",
                        "repo_name": "testbed/matplotlib__matplotlib__3.4",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet shows an example of sharing axes which is relevant to the issue, although it does not directly address the 'axis('equal')' part."
                }
            ],
            "galleries/examples/subplots_axes_and_figures/subplots_demo.py": [
                {
                    "chunk": {
                        "code": "ax4.plot(x, -y**2, 'tab:red')\n\nfor ax in fig.get_axes():\n    ax.label_outer()\n\n# %%\n# Sharing axes\n# \"\"\"\"\"\"\"\"\"\"\"\"\n#\n# By default, each Axes is scaled individually. Thus, if the ranges are\n# different the tick values of the subplots do not align.\n\nfig, (ax1, ax2) = plt.subplots(2)\nfig.suptitle('Axes values are scaled individually by default')\nax1.plot(x, y)\nax2.plot(x + 1, -y)\n\n# %%\n# You can use *sharex* or *sharey* to align the horizontal or vertical axis.\n\nfig, (ax1, ax2) = plt.subplots(2, sharex=True)\nfig.suptitle('Aligning x-axis using sharex')\nax1.plot(x, y)\nax2.plot(x + 1, -y)\n\n# %%\n# Setting *sharex* or *sharey* to ``True`` enables global sharing across the\n# whole grid, i.e. also the y-axes of vertically stacked subplots have the\n# same scale when using ``sharey=True``.\n\nfig, axs = plt.subplots(3, sharex=True, sharey=True)\nfig.suptitle('Sharing both axes')\naxs[0].plot(x, y ** 2)\naxs[1].plot(x, 0.3 * y, 'o')\naxs[2].plot(x, y, '+')\n\n# %%\n# For subplots that are sharing axes one set of tick labels is enough. Tick\n# labels of inner Axes are automatically removed by *sharex* and *sharey*.\n# Still there remains an unused empty space between the subplots.\n#\n# To precisely control the positioning of the subplots, one can explicitly\n# create a `.GridSpec` with `.Figure.add_gridspec`, and then call its\n# `~.GridSpecBase.subplots` method.  For example, we can reduce the height\n# between vertical subplots using ``add_gridspec(hspace=0)``.\n#\n# `.label_outer` is a handy method to remove labels and ticks from subplots\n# that are not at the edge of the grid.\n\nfig = plt.figure()\ngs = fig.add_gridspec(3, hspace=0)\naxs = gs.subplots(sharex=True, sharey=True)\nfig.suptitle('Sharing both axes')\naxs[0].plot(x, y ** 2)\naxs[1].plot(x, 0.3 * y, 'o')\naxs[2].plot(x, y, '+')\n\n# Hide x labels and tick labels for all but bottom plot.\nfor ax in axs:\n    ax.label_outer()\n\n# %%\n# Apart from ``True`` and ``False``, both *sharex* and *sharey* accept the\n# values 'row' and 'col' to share the values only per row or column.\n\nfig = plt.figure()\ngs = fig.add_gridspec(2, 2, hspace=0, wspace=0)\n(ax1, ax2), (ax3, ax4) = gs.subplots(sharex='col', sharey='row')\nfig.suptitle('Sharing x per column, y per row')\nax1.plot(x, y)\nax2.plot(x, y**2, 'tab:orange')\nax3.plot(x + 1, -y, 'tab:green')\nax4.plot(x + 2, -y**2, 'tab:red')\n\nfor ax in fig.get_axes():\n    ax.label_outer()\n\n# %%\n# If you want a more complex sharing structure, you can first create the\n# grid of axes with no sharing, and then call `.axes.Axes.sharex` or\n# `.axes.Axes.sharey` to add sharing info a posteriori.\n\nfig, axs = plt.subplots(2, 2)\naxs[0, 0].plot(x, y)\naxs[0, 0].set_title(\"main\")\naxs[1, 0].plot(x, y**2)\naxs[1, 0].set_title(\"shares x with main\")\naxs[1, 0].sharex(axs[0, 0])\naxs[0, 1].plot(x + 1, y + 1)\naxs[0, 1].set_title(\"unrelated\")\naxs[1, 1].plot(x + 2, y + 2)\naxs[1, 1].set_title(\"also unrelated\")\nfig.tight_layout()\n\n# %%\n# Polar axes\n# \"\"\"\"\"\"\"\"\"\"\n#",
                        "filename": "galleries/examples/subplots_axes_and_figures/subplots_demo.py",
                        "start_index": 2986,
                        "end_index": 5917,
                        "start_line": 105,
                        "end_line": 205,
                        "max_line": 211,
                        "git_instance": "github",
                        "repo_name": "testbed/matplotlib__matplotlib__3.4",
                        "sha": ""
                    },
                    "reason_for_relevance": "This snippet includes examples of sharing axes and might contain relevant information for debugging the issue."
                }
            ]
        },
        "solution_task": "- Remove the `ax.axis(\"equal\")` line from your code, as it is incompatible with shared axes in Matplotlib version 2.2.2.\n- Alternatively, if maintaining an equal aspect ratio is essential, consider not sharing both axes by setting either `sharex=False` or `sharey=False` in the `plt.subplots` call.",
        "bouncer_response": {
            "score": 6,
            "criteria": "The RESPONSE must provide actionable, relevant guidance to more parts of the PROMPT's described issue to score higher.",
            "supporting_evidence": "The RESPONSE provides two actionable solutions to the problem described in the PROMPT. The first solution suggests removing the 'ax.axis(\"equal\")' line, which is directly related to the error message and could resolve the issue. The second solution offers an alternative approach by suggesting not to share both axes, which is also relevant to the problem. However, the RESPONSE does not address the underlying cause of why the code that worked in Matplotlib 2.0.2 does not work in 2.2.2, nor does it provide a workaround that maintains the desired functionality (equal aspect ratio with shared axes) as it was in the previous version. The code snippets provided are somewhat relevant but do not offer direct solutions to the problem. They seem to be more for reference rather than actionable debugging steps.",
            "clarification_questions": "NONE"
        },
        "end_time": 1711698625.770978,
        "result": "- Remove the `ax.axis(\"equal\")` line from your code, as it is incompatible with shared axes in Matplotlib version 2.2.2.\n- Alternatively, if maintaining an equal aspect ratio is essential, consider not sharing both axes by setting either `sharex=False` or `sharey=False` in the `plt.subplots` call.\n\n### Code snippets to check\n\n-  \u2192 [lib](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib) \u2192 [matplotlib](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib/matplotlib) \u2192 [axes](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//lib/matplotlib/axes)- [Lines 35 - 4442](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//lib/matplotlib/axes/_base.py#L35-L4442)\n\n This snippet contains a condition that raises a ValueError when both axes are shared and not equal to self, which is related to the issue of shared axes.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 1 - 35](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/axis_equal_demo.py#L1-L35)\n\n This snippet demonstrates the use of 'axis('equal')' which is part of the issue when combined with shared axes.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 1 - 57](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/shared_axis_demo.py#L1-L57)\n\n This snippet shows an example of sharing axes which is relevant to the issue, although it does not directly address the 'axis('equal')' part.\n-  \u2192 [galleries](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries) \u2192 [examples](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples) \u2192 [subplots_axes_and_figures](https://github.com/testbed/matplotlib__matplotlib__3.4/tree//galleries/examples/subplots_axes_and_figures)- [Lines 105 - 205](https://github.com/testbed/matplotlib__matplotlib__3.4/blob//galleries/examples/subplots_axes_and_figures/subplots_demo.py#L105-L205)\n\n This snippet includes examples of sharing axes and might contain relevant information for debugging the issue."
    }
}